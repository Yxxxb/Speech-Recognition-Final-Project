# 声纹对比

最初思路：构建模型分别预测两条输入语音的声纹类别，对结果进行比较。（问题：局限于数据集，我们无法对自己的声音和更加多元的声音进行对比。而且没法给出两音频之间的相似关系）

- 数据创建

  zhvoice 中文语音预料数据集 https://github.com/fighting41love/zhvoice

  对数据进行打标签（说话人唯一ID）

  音频处理，将音频转化为257*257的短时傅里叶变换（STFT）幅度谱。

  #### 短时傅里叶变换(Short-Time Fourier Transform, STFT)

  短时傅里叶变换定义为

  ![[公式]](https://www.zhihu.com/equation?tex=X%28n%2C%5Comega%29%3D%5Csum_%7Bm%3D-%5Cinfty%7D%5E%5Cinfty+x%28m%29w%28n-m%29e%5E%7B-j%5Comega+m%7D)

  其中 ![[公式]](https://www.zhihu.com/equation?tex=x%28m%29) 为输入信号， ![[公式]](https://www.zhihu.com/equation?tex=w%28m%29) 是窗函数，它在时间上反转并且有n个样本的偏移量。 ![[公式]](https://www.zhihu.com/equation?tex=X%28n%2C%5Comega%29) 是时间 ![[公式]](https://www.zhihu.com/equation?tex=n) 和频率 ![[公式]](https://www.zhihu.com/equation?tex=%5Comega) 的二维函数，它将信号的时域和频域联系起来，我们可以据此对信号进行时频分析，比如 ![[公式]](https://www.zhihu.com/equation?tex=S%28n%2C%5Comega%29%3D%7CX%28n%2C%5Comega%29%7C%5E2) 就是语音信号所谓的语谱图(Spectrogram)。

  画出上节中两路扫频信号叠加后的信号的语谱图，如下图

  ![img](https://pic3.zhimg.com/80/v2-970154dfa4dc6baa8fe2fbd3a6a90096_1440w.jpg)

  可见该信号是由一个0~250Hz二次递增的扫频信号和一个250~0Hz二次递减的扫频信号的叠加。通过STFT，我们可以很容易地得出非平稳信号的时变特性。

  继续对STFT进行分析。

  计算语谱 ![[公式]](https://www.zhihu.com/equation?tex=S%28n%2C%5Comega%29) 时采用不同窗长度，可以得到两种语谱图，即窄带和宽带语谱图。长时窗（至少两个基音周期）常被用于计算窄带语谱图，短窗则用于计算宽带语谱图。**窄带语谱图具有较高的频率分辨率和较低的时间分辨率**，良好的频率分辨率可以让语音的每个谐波分量更容易被辨别，在语谱图上显示为水平条纹。相反**宽带语谱图具有较高的时间分辨率和较低的频率分辨率**，低频率分辨率只能得到谱包络，良好的时间分辨率适合用于分析和检验英语语音的发音。

  如下图所示，分别为一段语音的帧长为128和512的语谱图。

  ![img](https://pic2.zhimg.com/80/v2-87181aac7ea3db14b722e10f88a3ca91_1440w.jpg)

  可见，对于帧长固定的短时傅里叶变换，在全局范围内的时间分辨率和频率分辨率是固定的。

- 模型构建：残差神经网络

  模型：Resnet-34  损失函数：ArcFace

  ![image-20211225223614324](G:\LearningSource\speech recognition\Final-Project-Myself\Speech-Recognition-Final-Project\Doc\声纹对比.assets\image-20211225223614324.png)

  每训练一轮结束之后，执行一次模型评估，计算模型的准确率，以观察模型的收敛情况。同样的，每一轮训练结束保存一次模型，分别保存了可以恢复训练的模型参数，也可以作为预训练模型参数。还保存预测模型，用于之后预测。

  

------

更改：不对输入语音进行预测，而是去对比模型过程中输出的特征值，对两输入语音特征值求解对角余弦值得到相似度，然后设置阈值判断两音频是否来自已同一个人。

```python
dist = np.dot(feature1, feature2) / (np.linalg.norm(feature1) * np.linalg.norm(feature2))
```



# 音量计算

幅值平方和的常数对数的10倍：
$$
volume=10*log_{10}{\sum_{i=1}^{n}s_i^2}
$$
它的单位是分贝（Decibels），是一个对数强度值，比较符合人耳对声音大小的感觉，但计算量稍复杂。







